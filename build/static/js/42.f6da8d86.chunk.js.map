{"version":3,"sources":["functions/user.js","pages/Checkout.js"],"names":["userCart","cart","authtoken","a","axios","post","process","headers","getUserCart","get","emptyUserCart","delete","saveUserAddress","address","applyCoupon","coupon","createOrder","stripeResponse","getUserOrders","getWishlist","removeWishlist","productId","put","addToWishlist","createCashOrderForUser","COD","couponTrueOrFalse","couponApplied","Checkout","history","useState","products","setProducts","total","setTotal","setAddress","addressSaved","setAddressSaved","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","useDispatch","useSelector","state","user","useEffect","token","then","res","console","log","JSON","stringify","data","cartTotal","saveAddressToDb","ok","toast","success","applyDiscountCoupon","type","payload","err","className","theme","value","onChange","onClick","e","target","length","map","p","i","key","product","title","color","count","price","disabled","window","localStorage","removeItem","setTimeout","push"],"mappings":"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","file":"static/js/42.f6da8d86.chunk.js","sourcesContent":["import axios from \"axios\";\n\nexport const userCart = async (cart, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cart`,\n    { cart },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const getUserCart = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const emptyUserCart = async (authtoken) =>\n  await axios.delete(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const saveUserAddress = async (authtoken, address) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/address`,\n    { address },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const applyCoupon = async (authtoken, coupon) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cart/coupon`,\n    { coupon },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const createOrder = async (stripeResponse, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/order`,\n    { stripeResponse },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const getUserOrders = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/orders`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const getWishlist = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/wishlist`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const removeWishlist = async (productId, authtoken) =>\n  await axios.put(\n    `${process.env.REACT_APP_API}/user/wishlist/${productId}`,\n    {},\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const addToWishlist = async (productId, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/wishlist`,\n    { productId },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const createCashOrderForUser = async (\n  authtoken,\n  COD,\n  couponTrueOrFalse\n) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cash-order`,\n    { couponApplied: couponTrueOrFalse, COD },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n  createCashOrderForUser,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user, COD } = useSelector((state) => ({ ...state }));\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\n      console.log(\"USER CASH ORDER CREATED RES \", res);\n      // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\n        // empty redux cart\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: [],\n        });\n        // empty redux coupon\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n        // empty redux COD\n        dispatch({\n          type: \"COD\",\n          payload: false,\n        });\n        // mepty cart from backend\n        emptyUserCart(user.token);\n        // redirect\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            {COD ? (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={createCashOrder}\n              >\n                Place Order\n              </button>\n            ) : (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={() => history.push(\"/payment\")}\n              >\n                Place Order\n              </button>\n            )}\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n"],"sourceRoot":""}